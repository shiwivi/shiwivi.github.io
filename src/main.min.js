/*
 * @Author: SHIWIVI 
 * @Date: 2021-10-27 05:06:00 
 * @Last Modified by: SHIWIVI
 * @Last Modified time: 2025-05-07 23:00:32
 */
"use strict";function debounce(t,e){let n=null;return function(...a){clearTimeout(n),n=setTimeout(()=>{t.apply(this,a)},e)}}function showTitle(t,e){let n=0,a="";for(let e of t.innerText)a+="<span>"+e+"</span>";t.innerHTML=a,setTimeout(()=>{let e=setInterval(()=>{t.children[n++].style.opacity="1",n>=t.children.length&&clearInterval(e)},100)},e)}function typeText(){let t=0,e=0,n=!0;setInterval(()=>{e>=0?textBox.innerText=n?content[t].substring(0,++e):content[t].substring(0,e--):e--,e>=content[t].length+8&&(n=!1),e<-10&&(t++,n=!0,e=0,t>=content.length&&(t=0))},150)}function createStarElement(t,e,n){const a=createElement("div");return a.className=t,a.style.cssText=`top:${e}%;left:${n}%;`,a}function addTwinklingStars(){const t=document.createDocumentFragment(),e=2*PI*random(),n=round(15*sin(e)),a=round(15*cos(e));t.appendChild(createStarElement("twinkle_star1",30,55)),t.appendChild(createStarElement("twinkle_star2",50+n,50+a)),t.appendChild(createStarElement("twinkle_star3",50-n,50-a)),t.appendChild(createStarElement("twinkle_star4",getRandomInRange(40,60),getRandomInRange(40,60)));for(let e=0;e<canvasStarCount.star3;e++){const e=createElement("span");let n=sqrt(random())*skySize/2,a=getRandomInRange(0,2*PI);e.className="star3 "+star3color[getRandomIndex(4)],e.style.transform=`translate(${n*cos(a)}px,${n*sin(a)}px)`,e.style.setProperty("--duration",getRandomInRange(6,16)+"s"),e.style.setProperty("--delay",getRandomInRange(0,5)+"s"),t.appendChild(e)}sky.appendChild(t)}function canvasRender(){function t(){canvas_sky.width=window.innerWidth*l,canvas_sky.height=window.innerHeight*l,g=canvas_sky.width/2,w=canvas_sky.height/2,f=max(window.innerWidth,window.innerHeight)/2,ctx.scale(l,l)}function e(t){const e=new Float32Array(2*t);for(let n=0;n<t;n++){const t=sqrt(random())*f,a=getRandomInRange(0,2*PI);e.set([t*cos(a),t*sin(a)],2*n)}return e}function n(t){const e=.618*t;return e-(0|e)}function a(t){const e=new Float32Array(t);for(let a=0;a<t;a++)e[a]=1/(4*n(a)+5);return e}function s(t){const e=new Float32Array(t);for(let a=0;a<t;a++)e[a]=n(a+t)*PI*2;return e}function i(t){let e,n,a;if(t.startsWith("#")){const s=t.slice(1),i=3===s.length?s.split("").map(t=>t+t).join(""):s;e=parseInt(i.substring(0,2),16),n=parseInt(i.substring(2,4),16),a=parseInt(i.substring(4,6),16)}else{if(!t.startsWith("rgb"))return console.warn("star2颜色解析错误,将被替换为#fff"),i("#fff");{const s=t.match(/\d+/g);if(!s||s.length<3)return console.warn("star2颜色解析错误,将被替换为#fff"),i("#fff");[e,n,a]=s.map(Number)}}const s=t=>min(255,max(0,t));e=s(e),n=s(n),a=s(a);const o=Array.from({length:11},(t,e)=>e/10);return o.map(t=>`rgba(${e}, ${n}, ${a}, ${t%1==0?t.toString():t.toFixed(1)})`)}function o(t,e,n,a,s){const i=PI*s;for(let s=0;s<t.length;s+=2){const o=s>>1,r=i*n[o]+a[o],c=sin(r)**2;ctx.fillStyle=e[floor(c*e.length)],ctx.fillRect(t[s],t[s+1],1,1)}}function r(){for(let t=0;t<h.length;t+=2)ctx.fillStyle="#fff",ctx.fillRect(h[t],h[t+1],1,1)}function c(t,e,n,a,s){const i=PI*s;for(let s=0;s<t.length;s+=2){const o=s>>1,r=i*n[o]+a[o],c=sin(r)**2;ctx.beginPath(),ctx.fillStyle=e[o%p.length][floor(c*e[0].length)],ctx.arc(t[s],t[s+1],1,0,2*PI),ctx.fill(),ctx.closePath()}}function d(){function t(e){const a=(e-k)/1e3;ctx.clearRect(0,0,canvas_sky.width,canvas_sky.height),a-b>5&&(b=a,!C.active&&random()>.8&&C.spawn(),random()>.9&&v.trigger()),C.update(),v.draw(),ctx.save(),ctx.translate(g/l,w/l),ctx.rotate(S),r(),o(u,f,n,d,a),c(m,x,n,d,a),ctx.restore(),S+=2e-4,animationFrameID=requestAnimationFrame(t)}h=e(canvasStarCount.steady),u=e(canvasStarCount.blinking),m=e(canvasStarCount.star2);const n=a(max(canvasStarCount.blinking,canvasStarCount.star2)),d=s(max(canvasStarCount.blinking,canvasStarCount.star2)),f=i("#fff"),x=p.map(t=>i(t)),C=new y(ctx);let b=0;const k=performance.now();let S=0;requestAnimationFrame(t)}const l=isMobile?1:window.devicePixelRatio||1;let h=null,u=null,m=null,g=0,w=0,f=0;const p=["#fff","#1a96fc","#b542fd","#e8ae02"],v=(()=>{const t={x:page2Width+50,y:getRandomInRange(150,page2Height-150),img:new Image,loaded:!1,enabled:!1,init(){this.img.src="./src/spaceship.png",this.img.onload=(()=>{this.loaded=!0}),this.img.onerror=(()=>{console.warn("图片加载失败,飞船动画将被禁用"),this.loaded=!1})},trigger(){this.loaded&&(this.enabled||(this.x=page2Width+50,this.y=getRandomInRange(80,page2Height-80),this.enabled=!0))},draw:isMobile?function(){this.enabled&&(this.x<-250?this.enabled=!1:(this.x-=3,ctx.drawImage(this.img,0,30,129,20,this.x,this.y,65,10),ctx.drawImage(this.img,0,50,129,25,this.x+200,this.y,65,12)))}:function(){this.enabled&&(this.x<-250?this.enabled=!1:(this.x-=6,ctx.drawImage(this.img,0,30,129,20,this.x,this.y,129,20),ctx.drawImage(this.img,0,50,129,25,this.x+200,this.y,129,25)))}};return t.init(),t})();class y{constructor(t){this.ctx=t,this.spawn(),this.active=!1,this.cacheCanvas=createElement("canvas"),this.cacheCtx=this.cacheCanvas.getContext("2d"),this.setCache()}setCache(){this.cacheCanvas.width=400,this.cacheCanvas.height=400;let t=this.cacheCtx.createLinearGradient(0,400,400,0);t.addColorStop(0,"#fff"),t.addColorStop(1,"transparent"),this.cacheCtx.shadowColor="rgb(255, 255, 255)",this.cacheCtx.shadowBlur=6,this.cacheCtx.strokeStyle=t,this.cacheCtx.beginPath(),this.cacheCtx.moveTo(400,0),this.cacheCtx.lineTo(0,400),this.cacheCtx.stroke()}spawn(){this.x=basePosition+random()*positionOffset,this.y=-500,this.active=!0}update(){this.active&&(this.x-=15,this.y+=15,this.draw(),this.y>page2Height+500&&(this.active=!1))}draw(){this.ctx.save(),this.ctx.drawImage(this.cacheCanvas,this.x,this.y,400,400),this.ctx.restore()}}t(),d(),renderInfo.innerText="Canvas"}function DOMRender(){function t(){const t=[];a(t,"star1",n),a(t,"star2",n,star2Color),a(t,"star3",n,star3color),sky.innerHTML=t.join(""),renderInfo.innerText="Dom"}function e(){const t=[];a(t,"star1",n),a(t,"star2",n,star2Color),a(t,"star3",n,star3color),sky.innerHTML=t.join(""),renderInfo.innerText="Dom"}const n=["flash1","flash2","flash3","flash4"],a=(t,e,n,a)=>{a||(a=[""]);const s=skySize/2;for(let i=0;i<domStarCount[`${e}Nums`];i++){let o=sqrt(random())*s,r=getRandomInRange(0,2*PI);t.push(`<span class="${e} ${a[i%a.length]} ${n[getRandomIndex(4)]}" style="transform:translate(${o*sin(r)}px,${o*cos(r)}px)"></span>`)}};isMobile?e():t()}function detectIdleness(){function t(){n&&(a.classList.remove("standby"),s.classList.remove("standby")),clearTimeout(e),e=setTimeout(()=>{a.classList.add("standby"),s.classList.add("standby"),n=!0},5e3)}if(isMobile)return;let e=0,n=!1;const a=document.querySelector(".wormholes"),s=document.querySelector(".BgBtn");window.addEventListener("mousemove",t),window.addEventListener("click",t),window.addEventListener("touchstart",t),window.addEventListener("keydown",t),t()}function cleanupFirstPage(){new Promise(t=>{canvas_fluid.removeEventListener("mousedown",mousedownAct),canvas_fluid.removeEventListener("mousemove",mousemoveAct),canvas_fluid.removeEventListener("mouseup",mouseupAct),canvas_fluid.removeEventListener("touchstart",touchstartAct),canvas_fluid.removeEventListener("touchmove",touchmoveAct,!1),canvas_fluid.removeEventListener("touchend",touchendAct),setTimeout(()=>{t()},500)}).then(()=>{loseContextExt&&loseContextExt.loseContext(),canvas_fluid.parentNode.removeChild(canvas_fluid)})}function resizeHandler(){page2Width=page2.offsetWidth,page2Height=page2.offsetHeight,skySize=max(page2Height,page2Width),sky.style.width=sky.style.height=skySize+"px",page2.style.height=window.innerHeight+"px",sky.innerHTML="",BgSwitch.checked?(window.cancelAnimationFrame(animationFrameID),drawCanvasBackground()):buildDOMBackground()}function drawCanvasBackground(){canvasRender(),addTwinklingStars()}function buildDOMBackground(){window.cancelAnimationFrame(animationFrameID),ctx.clearRect(0,0,canvas_sky.width,canvas_sky.height),DOMRender(),addTwinklingStars()}function loadPage2(){main.style.top="-100vh",cleanupFirstPage(),typeText(),detectIdleness(),drawCanvasBackground(),window.addEventListener("resize",debounce(resizeHandler,1e3))}const{sqrt:sqrt,random:random,floor:floor,round:round,sin:sin,cos:cos,max:max,min:min,pow:pow,PI:PI}=Math,getRandomIndex=t=>floor(random()*t),getRandomInRange=(t,e)=>t+random()*(e-t),createElement=document.createElement.bind(document);window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFram||window.mozRequestAnimationFram||window.oRequestAnimationFram||window.msRequestAnimationFram||function(t){window.setTimeout(t,1e3/60)};const isMobile=/(mobile|android|phone|iphone|ipad|ipod|pad|mqqbrowser|juc|coolpad|mmp|smartphone|midp|wap|xoom|symbian|j2me|blackberry|wince|windowsphone)/.test(navigator.userAgent.toLowerCase()),main=document.querySelector(".main"),door=document.querySelector(".door"),webTitle=document.querySelector(".webTitle"),subtitle=document.querySelector(".subtitle"),canvas_sky=document.getElementById("canvas_sky"),ctx=canvas_sky.getContext("2d"),page2=document.querySelector(".page2"),textBox=document.querySelector(".textBox"),verse=document.querySelector(".verse"),sky=document.querySelector(".sky"),BgSwitch=document.getElementById("BgSwitch"),renderInfo=document.querySelector(".renderInfo");let animationFrameID=null,page2Width=page2.offsetWidth,page2Height=page2.offsetHeight,skySize=max(page2Height,page2Width);const verseContent=["我们都生活在阴沟里，仍有人仰望星空","如果你瞄准月亮，即使迷失也是落在星河之间","月亮踩碎星光，我们都是藏于银河的幻想","春光恰与少年同，十里清风慕天青"],content=["技术&生活&分享&回忆","欢迎来到SHIWIVI的网站","服务器在国外,加载会有亿点点慢","网站可能包含一些未知彩蛋","问题不大","该页面已通过「能跑就行」测试","但以下页面没有","可能包含严重bug!","问题不大"];let page2Config={PC:{basePosition:window.innerWidth/2,positionOffset:window.innerWidth/2,star2Color:["star2_white","star2_white","star2_white","star2_white","star2_blue","star2_purple","star2_orange"],star3color:["star3_white","star3_white","star3_purple","star3_blue"],canvasStarCount:{steady:300,blinking:300,star2:400,star3:150},domStarCount:{star1Nums:400,star2Nums:200,star3Nums:100}},mobile:{basePosition:window.innerWidth/3*2,positionOffset:window.innerWidth,star2Color:["star2_white","star2_white","star2_blue","star2_purple","star2_orange"],star3color:["star3_white","star3_purple","star3_blue"],canvasStarCount:{steady:80,blinking:80,star2:100,star3:50},domStarCount:{star1Nums:130,star2Nums:20,star3Nums:15}}},{basePosition:basePosition,positionOffset:positionOffset,star2Color:star2Color,star3color:star3color,canvasStarCount:canvasStarCount,domStarCount:domStarCount,canvasconfig:canvasconfig}=isMobile?page2Config.mobile:page2Config.PC;door.addEventListener("click",loadPage2,{once:!0}),main.addEventListener("wheel",loadPage2,{once:!0}),BgSwitch.addEventListener("click",()=>{0==BgSwitch.checked?(sky.innerHTML="",window.cancelAnimationFrame(animationFrameID),ctx.clearRect(0,0,canvas_sky.width,canvas_sky.height),buildDOMBackground()):(sky.innerHTML="",drawCanvasBackground())}),document.addEventListener("readystatechange",t=>{"interactive"===t.target.readyState&&(sky.style.width=sky.style.height=skySize+"px",page2.style.height=window.innerHeight+"px")}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState?document.title="这个页面会占用很多内存哦":(document.title="",setTimeout(function(){document.title="SHIWIVI"},3e3))}),window.addEventListener("load",function(){showTitle(webTitle,100),showTitle(subtitle,800),verse.innerText=verseContent[round(random()*(verseContent.length-1))]});